rule Malware_Generic {
    meta:
        description = "Generic malware indicators"
        author = "MalHunter Team"
        date = "2023-11-15"
    
    strings:
        $mz_header = { 4D 5A }
        $pe_header = "PE" 
        $shellcode = { E8 00 00 00 00 }  // CALL with 0 offset
        $injection = { 68 ?? ?? ?? ?? C3 }  // PUSH + RET
        $antidebug = "IsDebuggerPresent"
        $vm_check = "VBox" nocase
        $sandbox_check = "SbieDll" nocase
    
    condition:
        $mz_header at 0 and $pe_header and 2 of ($shellcode, $injection, $antidebug, $vm_check, $sandbox_check)
}

rule RAT_Behavior {
    meta:
        description = "Remote Access Trojan characteristics"
        author = "MalHunter Team"
    
    strings:
        $cmd_shell = "cmd.exe" nocase
        $powershell = "powershell" nocase
        $download = "URLDownloadToFile" nocase
        $persistence = "CurrentVersion\\Run" nocase
    
    condition:
        all of them
}
